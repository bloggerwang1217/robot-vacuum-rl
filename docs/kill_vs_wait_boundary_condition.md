# 殺人 vs 等待策略的邊界條件推導

## 核心洞察

**關鍵發現：** Episode 結束後的獨佔收益在兩個策略中都存在，因此可以約掉。真正的差異在於：
1. 等待期間獲得的充電收益 vs 殺人的機會成本
2. 提前獨佔的額外收益 vs 被干擾的損失

---

## 符號定義

### 時間參數
- `T_max`: Episode 最大長度（1000 步）
- `T_death`: 敵人自然死亡時間（HP / e_move）
- `t_kill`: 殺光所有敵人所需時間

### 效率參數
- `α`: 等待期間的充電效率（0 ≤ α ≤ 1）
  - 如果敵人習得無助：α ≈ 0.9-0.95
  - 如果敵人真實競爭（4人）：α ≈ 0.25
- `β`: 獨佔時的充電效率（通常 β ≈ 1）

### Reward 參數
- `r_c`: 充電 reward（每次充電獲得）
- `γ`: 折扣因子（0.99）

---

## 策略收益分解

### 策略 A：等待（Wait）

**時間軸：**
```
[0, T_death):     等待敵人自然死亡，充電效率 α
[T_death, T_max): 完全獨佔，充電效率 β
```

**總收益：**
```
Q_wait = Σ(t=0 to T_death-1) [α * r_c * γ^t]
       + Σ(t=T_death to T_max-1) [β * r_c * γ^t]
```

### 策略 B：殺人（Kill）

**時間軸：**
```
[0, t_kill):      追殺敵人，充電效率 0（離開充電器）
[t_kill, T_max):  完全獨佔，充電效率 β
```

**總收益：**
```
Q_kill = Σ(t=0 to t_kill-1) [0 * r_c * γ^t]
       + Σ(t=t_kill to T_max-1) [β * r_c * γ^t]
       = Σ(t=t_kill to T_max-1) [β * r_c * γ^t]
```

---

## 關鍵推導：約掉共同項

### 分解殺人策略的收益

將 `[t_kill, T_max)` 拆成兩段：
```
Σ(t=t_kill to T_max-1) [β * r_c * γ^t]
= Σ(t=t_kill to T_death-1) [β * r_c * γ^t]     # 提前獨佔期
  + Σ(t=T_death to T_max-1) [β * r_c * γ^t]   # 原本就會獨佔期
```

### 計算差異

```
ΔQ = Q_wait - Q_kill

   = Σ(t=0 to T_death-1) [α * r_c * γ^t]
     + Σ(t=T_death to T_max-1) [β * r_c * γ^t]
     - Σ(t=t_kill to T_death-1) [β * r_c * γ^t]
     - Σ(t=T_death to T_max-1) [β * r_c * γ^t]

   = Σ(t=0 to T_death-1) [α * r_c * γ^t]
     - Σ(t=t_kill to T_death-1) [β * r_c * γ^t]
```

**關鍵：** `[T_death, T_max)` 的收益約掉了！

### 進一步分解

將 `[0, T_death)` 拆成兩段：
```
Σ(t=0 to T_death-1) [α * r_c * γ^t]
= Σ(t=0 to t_kill-1) [α * r_c * γ^t]          # 殺人期間的等待收益
  + Σ(t=t_kill to T_death-1) [α * r_c * γ^t]  # 殺人後的等待收益
```

代入：
```
ΔQ = Σ(t=0 to t_kill-1) [α * r_c * γ^t]
     + Σ(t=t_kill to T_death-1) [α * r_c * γ^t]
     - Σ(t=t_kill to T_death-1) [β * r_c * γ^t]

   = Σ(t=0 to t_kill-1) [α * r_c * γ^t]
     + Σ(t=t_kill to T_death-1) [(α - β) * r_c * γ^t]
```

---

## 物理意義

### 項 1：等待策略在殺人期間的收益
```
Σ(t=0 to t_kill-1) [α * r_c * γ^t] ≈ α * r_c * t_kill

解釋：等待策略在前 t_kill 步能獲得一些充電收益（效率 α）
     殺人策略在這段時間沒有充電（效率 0）

這是等待策略的優勢！
```

### 項 2：提前獨佔的收益 - 被干擾的損失
```
Σ(t=t_kill to T_death-1) [(α - β) * r_c * γ^t] ≈ (α - β) * r_c * (T_death - t_kill)

解釋：在 [t_kill, T_death) 這段時間
     等待策略：充電效率 α（被敵人干擾）
     殺人策略：充電效率 β ≈ 1（完全獨佔）

由於 α < β，這一項是負的
這是殺人策略的優勢！
```

---

## 邊界條件推導

### 殺人策略更優的條件

```
Q_kill > Q_wait
⟺ ΔQ < 0
⟺ Σ(t=0 to t_kill-1) [α * r_c * γ^t] + Σ(t=t_kill to T_death-1) [(α - β) * r_c * γ^t] < 0
```

### 近似（忽略折扣，因為時間段較短）

設 γ^t ≈ 1（或提出平均值）：
```
α * r_c * t_kill + (α - β) * r_c * (T_death - t_kill) < 0

約掉 r_c：
α * t_kill + (α - β) * (T_death - t_kill) < 0

展開：
α * t_kill + α * T_death - α * t_kill - β * T_death + β * t_kill < 0

簡化：
α * T_death - β * T_death + β * t_kill < 0

β * (t_kill - T_death) < -α * T_death

β * (T_death - t_kill) > α * T_death
```

### **關鍵邊界條件：**

```
T_death - t_kill > (α / β) * T_death
```

或等價地：
```
t_kill < (1 - α/β) * T_death
```

**解釋：**
殺人策略更優，當且僅當：
**提前獨佔的時間 > (競爭效率/獨佔效率) × 自然死亡時間**

---

## 具體數值分析

### 情境 1：敵人習得無助（當前情況）

```
參數：
α = 0.94 (R0 實質獨佔，94% 效率)
β = 1.0 (完全獨佔)
T_death = 100 步
t_kill = 18 步

邊界條件：
T_death - t_kill > (α / β) * T_death
100 - 18 > 0.94 * 100
82 > 94
❌ 不成立

結論：等待策略更優（Q_wait > Q_kill）
```

### 情境 2：敵人真實競爭

```
參數：
α = 0.25 (4 人競爭，每人 25% 效率)
β = 1.0
T_death = 100 步
t_kill = 18 步

邊界條件：
100 - 18 > 0.25 * 100
82 > 25
✓ 成立

結論：殺人策略更優（Q_kill > Q_wait）
```

### 情境 3：臨界點

```
求解 α_critical 使得 Q_kill = Q_wait：

T_death - t_kill = α_critical * T_death

α_critical = (T_death - t_kill) / T_death
          = (100 - 18) / 100
          = 0.82

臨界值：α_critical = 82%
```

**解釋：**
- 如果等待期間充電效率 < 82%：殺人更優 ✓
- 如果等待期間充電效率 > 82%：等待更優 ✗

**當前實際：α ≈ 94% > 82%，所以等待更優！**

---

## 精確計算（考慮 γ 折扣）

### 幾何級數求和

```
S(a, b, r) = Σ(t=a to b) [r * γ^t]
           = r * γ^a * (1 - γ^(b-a+1)) / (1 - γ)
```

### 精確的 ΔQ

```
ΔQ = α * r_c * S(0, t_kill-1)
   + (α - β) * r_c * S(t_kill, T_death-1)

   = α * r_c * γ^0 * (1 - γ^t_kill) / (1 - γ)
   + (α - β) * r_c * γ^t_kill * (1 - γ^(T_death - t_kill)) / (1 - γ)

   = r_c / (1 - γ) * [
       α * (1 - γ^t_kill)
       + (α - β) * γ^t_kill * (1 - γ^(T_death - t_kill))
     ]
```

### 邊界條件（精確）

```
Q_kill > Q_wait ⟺ ΔQ < 0

α * (1 - γ^t_kill) + (α - β) * γ^t_kill * (1 - γ^(T_death - t_kill)) < 0

令 A = 1 - γ^t_kill
令 B = γ^t_kill * (1 - γ^(T_death - t_kill))

α * A + (α - β) * B < 0
α * A + α * B - β * B < 0
α * (A + B) < β * B

α < β * B / (A + B)
```

### 數值代入（γ = 0.99, t_kill = 18, T_death = 100）

```
A = 1 - 0.99^18 = 1 - 0.835 = 0.165
B = 0.99^18 * (1 - 0.99^82) = 0.835 * 0.557 = 0.465

α < β * 0.465 / (0.165 + 0.465)
α < β * 0.465 / 0.630
α < 0.738 * β

如果 β = 1.0：
α_critical = 0.738 = 73.8%
```

**精確臨界值（考慮折扣）：α_critical ≈ 74%**

這比簡化版的 82% 更低（折扣削弱了遠期收益）。

**當前實際：α ≈ 94% > 74%，所以等待策略確實更優！**

---

## 參數敏感度分析

### 固定 T_death = 100，改變 t_kill

| t_kill | α_critical (簡化) | α_critical (精確) | 說明 |
|--------|-------------------|-------------------|------|
| 5      | 95%              | 89%              | 殺人很快，幾乎總是更優 |
| 10     | 90%              | 82%              | 殺人較快，容易更優 |
| 18     | 82%              | 74%              | 當前設定 |
| 30     | 70%              | 60%              | 殺人較慢，需要更多競爭壓力 |
| 50     | 50%              | 38%              | 殺人很慢，幾乎總是不優 |

**洞察：殺人時間越長，越需要敵人真實競爭（α 越小）才能讓殺人策略划算。**

### 固定 t_kill = 18，改變 T_death

| T_death | α_critical (簡化) | α_critical (精確) | 說明 |
|---------|-------------------|-------------------|------|
| 50      | 64%              | 48%              | 敵人死得快，等待策略更有利 |
| 100     | 82%              | 74%              | 當前設定 |
| 200     | 91%              | 87%              | 敵人活很久，殺人策略更有利 |
| 300     | 94%              | 91%              | 敵人活極久，幾乎總是殺人更優 |

**洞察：敵人活得越久，殺人策略越有利（因為提前獨佔的時間更長）。**

---

## 結論與建議

### 1. 為什麼當前設定下等待策略更優？

**數學證明：**
```
α = 94% (習得無助)
α_critical = 74%
α > α_critical → 等待策略更優
```

**物理解釋：**
- R0 在等待期間已經實質獨佔充電器（94% 效率）
- 殺人的機會成本（18 步不充電）> 提前獨佔的收益
- 差異：ΔQ = α * 18 - (β - α) * 82
            = 0.94 * 18 - 0.06 * 82
            = 16.9 - 4.9 = 12.0 > 0
- 等待策略多獲得 12 * r_c 的收益

### 2. 如何讓殺人策略更優？

**必須降低 α 到臨界值以下！**

**方法 A：強迫敵人競爭（降低 α）**
- 目標：α < 74%
- 當前：α ≈ 94%（敵人習得無助）
- 需要：讓敵人騷擾 R0 的期望收益變正

**方法 B：加快殺人速度（降低 t_kill）**
- 目標：t_kill < 5 步
- 當前：t_kill ≈ 18 步
- 需要：提高 e_collision 或降低敵人 HP
- 問題：失去「虐殺」特性

**方法 C：延長敵人生存時間（提高 T_death）**
- 目標：T_death > 200 步
- 當前：T_death = 100 步
- 需要：提高敵人 HP 或降低 e_move
- 問題：失去不對稱性，變成公平競爭

### 3. 最可行的方案

**打破習得無助，讓 α 降到 25-50%**

具體實現：
```python
# 降低騷擾的風險
e_collision = 20 → 10

# 提高騷擾的收益
# 推人後獲得 2-3 步的充電時間（機制設計）

# 降低死亡懲罰
death_penalty = -100 → -50

期望效果：
騷擾期望收益 = 0.7 * 10 - 0.3 * 50 = 7 - 15 = -8（接近持平）

如果持續調整，讓期望收益 > 0：
→ 敵人持續騷擾
→ α 降到 25-50%
→ α < α_critical = 74%
→ 殺人策略變為最優 ✓
```

---

## 附錄：完整推導過程

### 定義

設：
- `r(t, s)` = 在時刻 t 採用策略 s 時的即時 reward
- `s_w` = 等待策略
- `s_k` = 殺人策略

### 等待策略的即時 reward

```
r(t, s_w) = {
  α * r_c + r_s    if 0 ≤ t < T_death
  β * r_c + r_s    if T_death ≤ t < T_max
}

其中 r_s ≈ 0.1 是存活 reward（可忽略，因為兩策略都有）
```

### 殺人策略的即時 reward

```
r(t, s_k) = {
  r_s             if 0 ≤ t < t_kill (離開充電器)
  β * r_c + r_s   if t_kill ≤ t < T_max (獨佔)
}
```

### 總收益

```
Q_wait = Σ(t=0 to T_max-1) [r(t, s_w) * γ^t]
Q_kill = Σ(t=0 to T_max-1) [r(t, s_k) * γ^t]
```

### 差異（省略 r_s，因為約掉）

```
ΔQ = Σ(t=0 to T_death-1) [α * r_c * γ^t]
   + Σ(t=T_death to T_max-1) [β * r_c * γ^t]
   - Σ(t=t_kill to T_max-1) [β * r_c * γ^t]

   = Σ(t=0 to T_death-1) [α * r_c * γ^t]
   - Σ(t=t_kill to T_death-1) [β * r_c * γ^t]

   = Σ(t=0 to t_kill-1) [α * r_c * γ^t]
   + Σ(t=t_kill to T_death-1) [(α - β) * r_c * γ^t]
```

Q.E.D.
